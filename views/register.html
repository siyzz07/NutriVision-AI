<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register | AI Health Assistant</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

    <div class="container wide">
        <div style="text-align: center; margin-bottom: 20px;">
            <i class="fas fa-user-plus fa-3x" style="color: var(--primary-color);"></i>
        </div>
        <h2>Create Account</h2>
        <p class="subtitle">Join our AI-powered healthy lifestyle community</p>

        <!-- Personal Information Section -->
        <div class="section-title">
            <i class="fas fa-id-card"></i> Personal Information
        </div>
        
        <div class="form-group">
            <input id="name" type="text" placeholder="Full Name">
        </div>
        <div class="row">
            <div class="form-group">
                <input id="email" type="email" placeholder="Email Address">
            </div>
            <div class="form-group">
                <input id="password" type="password" placeholder="Password">
            </div>
        </div>

        <div class="row">
            <div class="form-group">
                <select id="gender">
                    <option value="">Select Gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <div class="form-group">
                <input id="dob" type="date" placeholder="Date of Birth">
            </div>
        </div>

        <!-- Health Metrics Section -->
        <div class="section-title" style="margin-top: 20px;">
            <i class="fas fa-notes-medical"></i> Health Metrics
        </div>

        <div class="row">
            <div class="form-group">
                <input id="weight" type="number" placeholder="Weight (kg)">
            </div>
            <div class="form-group">
                <input id="height" type="number" placeholder="Height (cm)">
            </div>
        </div>

        <div class="toggle-group">
            <label style="margin:0;"><i class="fas fa-syringe"></i> Do you have Diabetes?</label>
            <div>
                <label style="display:inline; margin-right:15px;"><input type="radio" name="diabetes" value="Yes"> Yes</label>
                <label style="display:inline;"><input type="radio" name="diabetes" value="No" checked> No</label>
            </div>
        </div>

        <div class="row">
            <div class="form-group">
                <input id="cholesterol" type="text" placeholder="Cholesterol (mg/dL)">
            </div>
            <div class="form-group">
                <input id="bp" type="text" placeholder="Blood Pressure (e.g. 120/80)">
            </div>
        </div>

        <div class="section-title" style="margin-top: 20px;">
            <i class="fas fa-file-medical-alt"></i> Additional Parameters
        </div>
        
        <div id="parameters"></div>
        
        <button class="btn btn-outline" onclick="addParameter()" style="margin-bottom: 20px;">
            <i class="fas fa-plus"></i> Add Health Parameter
        </button>

        <button class="btn" onclick="register()">Create Account <i class="fas fa-check-circle"></i></button>

        <div class="link-text">
            Already have an account? <a href="/login">Login here</a>
        </div>
    </div>

    <script>
    function addParameter() {
        const container = document.getElementById("parameters");
        const row = document.createElement("div");
        row.className = "param-row";

        row.innerHTML = `
            <input type="text" placeholder="Parameter (e.g. SGPT)" class="param-name">
            <input type="text" placeholder="Measure" class="param-value">
            <select class="param-unit" style="min-width: 80px;">
                <option>Unit</option>
                <option>mg/dL</option>
                <option>U/L</option>
                <option>mmHg</option>
            </select>
            <button class="delete-btn" onclick="this.parentElement.remove()" title="Remove">
                <i class="fas fa-trash"></i>
            </button>
        `;

        container.appendChild(row);
    }

    async function register(){
        const name = document.getElementById("name").value.trim();
        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value;
        const gender = document.getElementById("gender").value;
        const dob = document.getElementById("dob").value;
        const weight = document.getElementById("weight").value;
        const height = document.getElementById("height").value;
        
        // Get Diabetes value
        const diabetesRadios = document.getElementsByName('diabetes');
        let diabetes = 'No';
        for(let radio of diabetesRadios){
            if(radio.checked) diabetes = radio.value;
        }
        
        const cholesterol = document.getElementById("cholesterol").value.trim();
        const bp = document.getElementById("bp").value.trim();

        // Validation
        if (!name) {
            alert("Please enter your full name.");
            return;
        }

        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
            alert("Please enter a valid email address.");
            return;
        }

        if (password.length < 6) {
            alert("Password must be at least 6 characters long.");
            return;
        }

        if (gender === "") {
            alert("Please select your gender.");
            return;
        }

        if (!dob) {
            alert("Please enter your date of birth.");
            return;
        }
        
        // Basic age validation
        const birthDate = new Date(dob);
        const today = new Date();
        if (birthDate > today) {
            alert("Date of birth cannot be in the future.");
            return;
        }

        if (!weight || weight <= 0) {
            alert("Please enter a valid weight in kg.");
            return;
        }

        if (!height || height <= 0) {
            alert("Please enter a valid height in cm.");
            return;
        }

        if (cholesterol && isNaN(cholesterol)) {
            alert("Cholesterol must be a numeric value.");
            return;
        }
        
        // Detailed Cholesterol validation (if provided or required)
        if (!cholesterol) {
             alert("Please enter your cholesterol level.");
             return;
        }
        if (cholesterol < 50 || cholesterol > 600) {
            alert("Please enter a valid cholesterol level between 50 and 600.");
            return;
        }

        // Detailed BP validation
        if (!bp) {
            alert("Please enter your blood pressure.");
            return;
        }
        
        const bpRegex = /^\d{2,3}\/\d{2,3}$/;
        if (!bpRegex.test(bp)) {
            alert("Blood Pressure format should be like 120/80.");
            return;
        }
        
        const [systolic, diastolic] = bp.split('/').map(Number);
        if (systolic < 70 || systolic > 250) {
            alert("Systolic blood pressure (first number) seems invalid. Normally between 70 and 250.");
            return;
        }
        if (diastolic < 40 || diastolic > 150) {
            alert("Diastolic blood pressure (second number) seems invalid. Normally between 40 and 150.");
            return;
        }

        
        // Collect additional parameters if needed (not implemented in original but could be useful)
        
        const userData = {
            name, email, password, gender, dob, weight, height, diabetes, cholesterol, bloodPressure: bp
        };

        try {
            const response = await fetch('/api/auth/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(userData)
            });
            
            const data = await response.json();
            
            if(response.ok){
                alert("Registration successful!");
                window.location.href = "/login";
            } else {
                alert("Error: " + (data.message || data.error));
            }
        } catch(err) {
            console.error(err);
            alert("Registration failed. Please try again later.");
        }
    }
    </script>

</body>
</html>
